<div class="drive-shell">

  <!-- HEADER -->
  <header class="drive-header">
    <div class="logo">SocialDrive</div>

    <div class="search-bar">
      <input
        type="text"
        placeholder="Search in SocialDrive (not yet implemented)"
      />
    </div>
  </header>

  <main class="drive-main">

    <!-- FOLDERS -->
    <aside class="sidebar">
      <app-folders
        [folders]="folders"
        [selectedFolderId]="selectedFolderId"
        (folderSelected)="selectFolder($event)"
        (deleteFolderEvent)="askDeleteFolder($event)"
        (createNewFolder)="openAddFolder()"
      ></app-folders>
    </aside>

    <!-- LINKS -->
    <section class="section">

      <div class="section-header">
  
        <nav class="drive-breadcrumbs" *ngIf="breadcrumbs?.length">
          <span
            class="crumb"
            *ngFor="let bc of breadcrumbs; let last = last"
            (click)="selectFolder(bc)"
          >
            {{ bc.name }}
            <span *ngIf="!last" class="separator">‚Ä∫</span>
          </span>
          >
        </nav>

        <span class="current-folder">
          {{ selectedSubFolderName || selectedFolderName }}
        </span>

    </div>

      <div *ngIf="isLoading" class="info">Loading‚Ä¶</div>

      <ng-container *ngIf="!isLoading">

        <aside class="sidebar">
            <app-folders
              [folders]="subFolders"
              [selectedFolderId]="selectedsubFolderId"
              (folderSelected)="selectSubFolder($event)"
              (deleteFolderEvent)="askDeleteSubFolder($event)"
            ></app-folders>
         </aside>

        <div *ngIf="links.length; else emptyState" class="link-grid">
          <!-- CARD (now <div>, not <a>) -->
          <div
            class="link-card"
            *ngFor="let link of links; trackBy: trackById"
          >

            <!-- CLICK AREA -->
            <div class="link-click-area" (click)="openLink(link)">
              <!-- IMAGE -->
              <div
                class="link-image"
                [class.link-image--empty]="!link.imageUrl"
                [style.background-image]="
                  link.imageUrl ? 'url(' + link.imageUrl + ')' : 'none'
                "
              >
                <span *ngIf="!link.imageUrl" class="link-initial">
                  {{ (link.title || link.url) | slice : 0 : 1 }}
                </span>
              </div>

              <!-- TEXT -->
              <div class="link-body">
                <div class="link-title" [title]="link.title || link.url">
                  {{ link.title || link.url }}
                </div>
                <div class="link-url">{{ link.url }}</div>
              </div>
            </div>

            <!-- DELETE BUTTON OUTSIDE LINK AREA -->
            <button
              class="link-delete"
              title="Delete"
              (click)="askDelete(link, $event)"
            >
              üóëÔ∏è
            </button>

          </div>
        </div>

        <ng-template #emptyState>
          <div class="empty">No links here yet. Use the <b>+</b> button.</div>
        </ng-template>

        

      </ng-container>
    </section>

  </main>

  <!-- Floating Action Button -->
  <button class="fab" (click)="toggleFabMenu()">+</button>

  <div class="fab-menu" *ngIf="fabOpen">
    <button (click)="openAddLink()">Add link</button>
    <button (click)="openAddFolder()">New folder</button>
  </div>

  <!-- ADD FOLDER / LINK DIALOG -->
  <div class="dialog-backdrop" *ngIf="showAddFolder || showAddLink">
    <div class="dialog">
      <h3 *ngIf="showAddFolder">New folder</h3>
      <h3 *ngIf="showAddLink">Add link</h3>

      <!-- FOLDER INPUT -->
      <ng-container *ngIf="showAddFolder">
        <input type="text" placeholder="Folder name" [(ngModel)]="newFolderName" />
      </ng-container>

      <!-- LINK INPUT -->
      <ng-container *ngIf="showAddLink">
        <input type="url" placeholder="Paste link URL" [(ngModel)]="newLinkUrl" />
      </ng-container>

      <div class="dialog-actions">
        <button class="text-btn" (click)="closeDialogs()">Cancel</button>
        <button class="primary-btn" *ngIf="showAddFolder" (click)="createFolder()">Create</button>
        <button class="primary-btn" *ngIf="showAddLink" (click)="createLink()">Save</button>
      </div>
    </div>
  </div>

  <!-- DELETE CONFIRM -->
  <div class="dialog-backdrop" *ngIf="showDeleteConfirm">
    <div class="dialog small">
      <h3>Delete link?</h3>
      <p>This action cannot be undone.</p>

      <div class="dialog-actions">
        <button class="text-btn" (click)="cancelDelete()">Cancel</button>
        <button class="primary-btn danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>

</div>
